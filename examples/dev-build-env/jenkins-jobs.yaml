- defaults:
    name: global
    mail-to: aweiteka@redhat.com
    description: 'A jenkins-jobs template to create jobs in Jenkins. Do not edit this job through the web.'
    source_uri: 'https://github.com/projectatomic/atomicapp/'

- project:
   name: automated-builds
   jobs:
    - '{name}-unittest'
#    - unittest "make test"
#    - dockerfile linter (part of unit test checks)
#      requires: can run in its own container or a slave or...?
#    - time-based (@hourly?) refresh image streams
#      requires: oc cmds
#    - time-based or other trigger to scan for image vulerabilities
#      requires: run from image scan image. how do we access the images or containers?
#                we want to run on all of the image streams
#    - update jenkins-jobs based on commit
#    - functional test of built container
#    - build job triggered by image scan, etc
#    - teardown job
#    - tag image based on functional test success


- job-template:
    name: '{name}-unittest'
    description: 'Run source unit tests'
    builders:
      - shell: 'python -m pytest -vv tests --cov atomicapp --cov-report=xml --junit-xml=result.xml'
    publishers:
    - email:
        recipients: '{mail-to}'

